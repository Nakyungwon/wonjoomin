<!DOCTYPE html>
<html>
  <head>
    <title>원주민공포만화</title>
    <% include ../parts/option %>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet"> 
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script> 
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script> 
    <link href="/javascripts/dist/summernote.css" rel="stylesheet">
    <script src="/javascripts/dist/summernote.min.js"></script>
    <!-- include summernote-ko-KR -->
    <script src="/javascripts/dist/lang/summernote-ko-KR.js"></script>
    <script src="/javascripts/common.js"></script>
    <script type="text/javascript">
        $(function(){
            $('#board_content').summernote({
                height: 300,                 
                minHeight: 300,             
                maxHeight: 300,
                lang:'ko-KR',
                toolbar: [
                            // [groupName, [list of button]]
                            ['style', ['bold', 'italic', 'underline', 'clear']],
                            ['font', ['strikethrough', 'superscript', 'subscript']],
                            ['fontsize', ['fontsize']],
                            ['color', ['color']],
                            ['para', ['ul', 'paragraph']],
                            ['table', ['table']],
                            ['insert', ['link']],
                        ],
                disableDragAndDrop: true
            });

            $('#sb_reg').click(function(){
                var boardCategoryCode               = $('#board_category_code');
                var nickName                        = $('#nick_name');
                var password                        = $('#password');
                var boardTitle                      = $('#board_title');
                var boardContent                    = $('#board_content');
                var logInfo                         = '<%= user_info %>'
                var userGrade                       = '<%= user_info !=null ? user_info.user_grade : null%>'
               
                if(userGrade == 'BRAHMAN'){
                    if(!isValid(boardCategoryCode,'카테고리')){
                        return false;
                    }
                }
                if(!logInfo){
                    if(!isValid(nickName,'닉네임')){
                        return false;
                    }

                    if(!isValid(password,'비밀번호')){
                        return false;
                    }
                }

                if(!isValid(boardTitle,'게시물 제목')){
                    return false;
                }
                /*게시물 내용은 summernote이므로 공통함수 못씀*/
                if(!isValidSummerNote(boardContent,'게시물 내용')){
                    return false;
                }
                
                $('#f_edit').submit();
            })

            $('input[name=file]').change(function(){
                if($(this).val() != "") { 
                    var extPlan = "JPG, PNG, JEPG ,GIF"; 
                    var checkSize = 1024*1024*10;	
                    // 10MB 
                    if(!checkImg($(this), extPlan)) { 
                        this.value = ""; 
                        return; 
                    } 
                    if(!checkImgSize($(this), checkSize)) { 
                        this.value = ""; 
                        return; 
                    } 
                }
            })

        })

        function sendFile(file) {
            var data = new FormData();
            data.append("file"          , file);
            $.ajax({
                type: "POST",
                url: "/board/up_img",
                type: 'POST',
                data: data,
                contentType: false,
                processData: false, // Don't process the files
                success: function(data) {
                    $('#board_content').summernote("insertImage", data.url);
                }
            });
        }
    </script>
  </head>
  <body>
    <% include ../parts/head %>
    <% include ../parts/carousel %>
    <div class="div_body_width">
        <% include ../parts/menu %>
        <form class="form-horizontal" id='f_edit' action="/p_board/edit" method="post" enctype="multipart/form-data">
            <input type="hidden" name='sm_menu_id' value='<%= sm_menu_id %>' > 
            <div class="container">
<% if(user_info && user_info.user_grade =='BRAHMAN'){%>
                <div class="row">
                    <div class="col-lg-9 col-lg-offset-1">
                        <div class="form-group">
                            <label for="select" class="col-lg-2 control-label">카테고리</label>
                            <div class="col-lg-10">
                                <select class="form-control" id="board_category_code" name='board_category_code'>
                                <option value=''>선택</option>   
                                <option value='G'>게시판공지</option>
                                <option value='N'>일반</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
<% } %>
<% if(!user_info){%>
                <div class="row">
                    <div class="col-lg-9 col-lg-offset-1">
                        <div class="form-group">
                            <label class="col-lg-2 control-label">닉네임</label>
                            <div class="col-lg-10">
                                <input type="text" class="form-control" id="nick_name" name='nick_name' maxlength="10">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-9 col-lg-offset-1">
                        <div class="form-group">
                            <label class="col-lg-2 control-label">비밀번호</label>
                            <div class="col-lg-10">
                                <input type="password" class="form-control" id="password" name='password' maxlength="12">
                            </div>
                        </div>
                    </div>
                </div>
<% } %>
                <div class="row">
                    <div class="col-lg-9 col-lg-offset-1">
                        <div class="form-group">
                            <label class="col-lg-2 control-label">제목</label>
                            <div class="col-lg-10">
                                <input type="text" class="form-control" id="board_title" name='board_title' maxlength="65">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" style="margin-top:20px;">
                    <div class="col-lg-9 col-lg-offset-1">
                        <div class="form-group">
                                <textarea id="board_content" name="board_content"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-9 col-lg-offset-1">
                        <div class="form-group">
                            <label for="exampleInputFile">파일선택(10M 미만)</label>
                            <input type="file" class="form-control-file" id="exampleInputFile" name="file" aria-describedby="fileHelp">
                            <input type="file" class="form-control-file" id="exampleInputFile" name="file" aria-describedby="fileHelp">
                            <input type="file" class="form-control-file" id="exampleInputFile" name="file" aria-describedby="fileHelp">
                        </div>
                    </div>
                </div>

                <div class="text-right div_board_btn">
                    <a href="javascript:history.back()" class="btn btn btn-danger">취소</a>
                    <a id='sb_reg' class="btn btn-primary">작성</a>
                </div>
            </div>
        </form>
    </div>
    <% include ../parts/footer %>
  </body>
</html>
